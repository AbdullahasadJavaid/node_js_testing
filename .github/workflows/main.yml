name: CI Debug Workflow

on:
  push:
    branches:
      - main
      - develop
  pull_request:

jobs:
  debug-job:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Print basic GitHub context
      - name: Print GitHub context
        run: |
          echo "==== GitHub Context ===="
          echo "Actor: $GITHUB_ACTOR"
          echo "Repository: $GITHUB_REPOSITORY"
          echo "Ref: $GITHUB_REF"
          echo "SHA: $GITHUB_SHA"
          echo "Event name: $GITHUB_EVENT_NAME"
          echo "========================"

      # 3. Print runner details
      - name: Print runner info
        run: |
          echo "==== Runner Info ===="
          uname -a
          echo "Current directory:"
          pwd
          echo "====================="

      # 4. List files (VERY useful for debugging)
      - name: List repository files
        run: |
          echo "==== Repository Files ===="
          ls -la
          echo "=========================="

      # 5. Print environment variables (filtered)
      - name: Print environment variables
        run: |
          echo "==== Environment Variables ===="
          env | sort
          echo "==============================="

      # 6. Example: Node.js setup (MERN-style)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Verify Node & NPM
        run: |
          echo "Node version:"
          node -v
          echo "NPM version:"
          npm -v

      # 7. Install dependencies with debug output
      - name: Install dependencies
        run: |
          echo "==== Installing dependencies ===="
          npm install --verbose
          echo "================================="

      # 8. Example: Custom debug check (naming / structure)
      - name: Debug project structure
        run: |
          echo "==== Checking folder structure ===="
          if [ ! -d "src" ]; then
            echo "❌ src folder NOT found"
            exit 1
          else
            echo "✅ src folder found"
          fi

          echo "Contents of src:"
          ls -la src
          echo "==================================="

      # 9. Example test step with debug
      - name: Run tests (if any)
        run: |
          echo "==== Running tests ===="
          npm test || {
            echo "❌ Tests failed"
            exit 1
          }
          echo "✅ Tests passed"
